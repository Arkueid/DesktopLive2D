# Changelog

### 2023-4-1
* 语音输入
	* 频繁点击录音按钮现在不会造成崩溃  

	* 添加自定义语音聊天接口，详细见test-server的[模板](./test-server/server.py)  

	* 录音文件是.wav格式，采样率16000，单声道，其他参数需要自行测试

* 聊天记录
	* 添加聊天记录窗口，支持语音播放，仅显示本次运行的所有聊天，下次启动会清空

		![聊天记录窗口](./sample_images/Snipaste_2023-04-01_20-27-55.png)

		![测试结果](./sample_images/Snipaste_2023-04-01_20-56-24.png)
	
	* 聊天记录窗口和输入窗口可以拖住边缘移动，聊天记录窗口支持屏幕侧边隐藏

	* 本地聊天记录改为html格式，记录时间，角色名，聊天内容，语音路径（可播放），浏览器打开如下：  

		![Html聊天记录](./sample_images/Snipaste_2023-04-01_20-48-56.png)

* 关于自定义

	* 聊天输入面板的三个图标是可以更换的，在Resources文件夹下把自己的图标改成对应名称即可

	* 有一部分样式在config.json中可以自定义

### 2023-3-26
* 语音输入
	* 录音和绘图放在不同线程，不会造成卡顿
	* 不要在短时间内多次点击录音按钮
	* 长按**语音输入按钮**或者激活输入窗口后按**alt键**进行录音
	* 目前使用百度语音识别 [api](https://ai.baidu.com/ai-doc/SPEECH/Vk38lxily#raw-%E6%96%B9%E5%BC%8F%E4%B8%8A%E4%BC%A0%E9%9F%B3%E9%A2%91)，client_id 和 client_secret 可以在 config.json 中更换

		![语音输入](sample_images/Snipaste_2023-03-26_11-11-53.png)

### 2023-3-25
* 语音输入
	* 目前使用百度语音识别 [api](https://ai.baidu.com/ai-doc/SPEECH/Vk38lxily#raw-%E6%96%B9%E5%BC%8F%E4%B8%8A%E4%BC%A0%E9%9F%B3%E9%A2%91)，client_id 和 client_secret 可以在 config.json 中更换
	* 长按**语音输入按钮**或者激活输入窗口后按**alt键**进行录音
	* 后续会添加自定义 POST 录音数据到自建服务端
	* 开始录音时界面会卡顿，卡顿时间看设备性能，原因是启动录音的函数和图形界面放在了一个线程里。不另开线程的原因是使用QAudioInput录音时，创建的实例不在主线程，输出的音频文件为空，暂时没有找到解决的方法，后续会考虑其他录音接口。

### 2023-3-21
* 输入框调整

	![聊天](sample_images/chat.png)  


### 2023-3-16
* 聊天输入窗口可右键按住边缘拖动；窗口添加发送和关闭按钮，点击发送不会自动关闭窗口；config.json中可修改部分样式属性  

	![预览](sample_images/Snipaste_2023-03-16_21-54-33.png)  

* 文本框自动换行优化，句末标点不会出现在行首
* 已知问题：  
频繁启动和退出可能弹出资源路径不正确的提示，该问题与<io.h>的_access函数有关，具体原因暂时不清楚

### 2023-3-15
* 音量控制
	* 使用 waveOutSetVolume api 控制输出音量

	* 开启后会检测模型的动作文件参数是否正确，如果不正确会对参数进行修正并保存。此功能用于应对[#5](https://github.com/Arkueid/Live2DMascot/issues/5)。开启后可能增加模型加载时间，修复模式下加载的模型，第二次加载可以不需要开启修复模式。

### 先前更新
* 修复  
	* Win64下设置页面打开导致程序崩溃
	* 程序启动失败的问题  

		**可能原因1**  

		启动时获取当前系统用户名的代码运行错误，现已删除获取当前系统用户名，默认用户名固定为UserXXXX。  

		![错误代码1](sample_images/error_fixed.png)

		**已确认原因2**  

		Dialog初始化时未给_fontMetrics变量赋值，程序启动时分配的初始值不为NULL，在LoadConfig函数中导致用delete释放了一个未被分配的内存。<del>哼哼哼啊啊啊(#>д<)ﾉ</del>

		![错误代码2](sample_images/bug_fixed.png)  


	* 番剧列表初次加载频闪问题（第二次修复） 
	* 网络请求模块无网络时导致程序崩溃 (第二次修复)